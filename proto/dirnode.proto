syntax = "proto3";

package clfs;

import "google/protobuf/timestamp.proto";

option go_package = "velda.io/clfs/pkg/proto";

message Key {
  string key = 1; // Key for the file
}

message FileStat {
  uint32 valid = 1;
  uint32 uid = 2;
  uint32 gid = 3;
  uint32 mode = 4;
  uint64 dev = 5;
  uint64 size = 6;
  uint64 inode = 7;
  google.protobuf.Timestamp atime = 8;
  google.protobuf.Timestamp mtime = 9;
  google.protobuf.Timestamp ctime = 10;
  uint32 nlink = 11; // Number of hard links
  // TODO: xattr
}

message DirEntry {
  string name = 1;
  bytes cookie = 2;
  uint32 type = 3;
  uint64 inode = 4;
  uint64 offset = 5;
}

message FileNode {
  FileStat stat = 1; // File statistics
  oneof content {
    // Key for the file to reference another file. Stats are ignored. Only for
    // large files.
    Key key = 2;
    bytes data = 3; // Content of the file
  }
}

message PersistedDirEntry {
  string name = 1;
  Key key = 2;
}

message DirectoryNode {
  // Directory statistics
  FileStat stat = 1;

  // List of child nodes, sorted by key.
  repeated PersistedDirEntry children = 2;
}

message SymlinkNode {
  string target = 1; // Target of the symlink
}

message Node {
  oneof node {
    DirectoryNode directory = 1; // Directory node
    FileNode file = 2;           // File node
    SymlinkNode symlink = 3;     // Symlink node
  }
}